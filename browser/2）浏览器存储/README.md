# 浏览器本地存储

浏览器本地存储分为`cookie、webstorage、indexDB`，webstorage又分为`localstorage、sessionstorage`

## Cookie

cookie是一种很小的本地存储，它就是一种明文的键值对。

其实cookie最开始并不是设计来用作本地存储的，他就是用来弥补早期HTTP在**状态管理上的不足**的 。

服务器和客户端通信，相互交互之后，就结束了，下一次再通信的时候，服务器还是不知道客户端是谁，因为HTTP是无状态的。

所以就有了cookie。在同一一级域名下，所有的请求都会带上该域名下的所有cookie。服务器拿到cookie进行解析就能得到客户端的状态，认识这个客户端。

但是cookie也是有生存时间的，当然这个过期时间时可以设置的。

为了保持客户的登陆状态，一般我们会将登陆flag存在cookie中，百度就是这么做的。你在百度贴吧登陆了，进入到百度知道，你会发现你在百度知道也是登陆状态，这就是cookie做的。

作为一种状态存储，cookie本身也是存在一些缺陷的：

1. 容量小：cookie的容量很小本身只有`4KB`，所以只能存储很少的信息
2. 安全差：因为cookie是明文的，存入什么，得到的就是什么。在`HttpOnly`为false的情况下，是可以通过js获取到cookie的，xss的攻击目标之一就有cookie
3. 性能浪费：因为同一个一级域名下的所有请求，会带上这个域名下的所有的cookie，不管服务器是否需要，这会带来性能的不比要浪费

## localstorage

本地存储

localstorage和cookie一样都是针对当前域名生效。不过呢，它的存储容量更大。

localstorage可以存储大小为5M，并且可以长期存储。而且它只存储在客户端，并不会参与到网络请求，localstorage在平常工作中用起来也非常方便，可以利用localstorage的长时间存储和大容量做很多事情。

## sessionstorage

会话存储

sessionstorage除了名字和存储时间，其他的和localstorage都是一样的，同样的大小，同样的操作方式。

不同的是sessionstorage只在会话窗口当前声明周期内生效，关闭窗口之后就没有了。

当我们遇到有些信息只需要在本次窗口打开的时间内生效，并且刷新也不丢失数据的话，就可以用到sessionstorage，这个时候vuex redux这种状态管理工具就不适用了。微博就是采用的这种方式来存储本次会话的浏览记录的。

## indexDB

这个是应用在浏览器中的`菲关系型数据库`，理论上是没有存储上限的。

indexDB本质就是一个数据库，它同样支持`事务`，可以存储`二进制数据`，

他的存储方式则是采用的`对象仓库`来存储，内部存储的都是一些键值对。

它是受同源策略限制的，无法访问非同源（跨域）的数据库

## 总结

浏览器中各种本地存储和缓存技术的发展，给前端应用带来了大量的机会，PWA 也正是依托了这些优秀的存储方案才得以发展起来。重新梳理一下这些本地存储方案:

1. cookie并不适合存储，而且存在非常多的缺陷。
2. Web Storage包括localStorage和sessionStorage, 默认不会参与和服务器的通信。
3. IndexedDB为运行在浏览器上的非关系型数据库，为大型数据的存储提供了接口。